<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªÙŠÙƒÙŠØªØ§Øª - RP City</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { margin: 0; font-family: 'Cairo', sans-serif; background: #000; color: white; padding: 20px; text-align: center; }
        .ticket-item { background: #1a1b4b; border: 1px solid #a855f7; border-radius: 15px; margin: 20px auto; padding: 20px; text-align: right; max-width: 800px; }
        .chat-box { background: rgba(0,0,0,0.3); padding: 15px; border-radius: 10px; margin: 15px 0; max-height: 250px; overflow-y: auto; }
        .msg { margin-bottom: 10px; padding: 8px; border-radius: 8px; }
        .player-msg { background: #333; border-right: 3px solid #0ea5e9; }
        .admin-msg { background: #4c1d95; border-right: 3px solid #a855f7; text-align: left; }
        input { width: 60%; padding: 10px; border-radius: 5px; border: none; font-family: 'Cairo'; }
        .reply-btn { background: #22c55e; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-family: 'Cairo'; }
        .del-btn { background: #ef4444; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>ğŸ“© Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªÙŠÙƒÙŠØªØ§Øª</h1>
    <div id="ticketsList">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
    <a href="admin_panel.html" style="color:#888; text-decoration:none;">â¬… Ø¹ÙˆØ¯Ø© Ù„Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</a>

    <script>
        const BIN_ID = "Ø¶Ø¹_Ù‡Ù†Ø§_BIN_ID_Ø§Ù„ØªÙŠÙƒÙŠØªØ§Øª";
        const MASTER_KEY = "$2a$10$EVJpa1kkUQx4JG6CPhwT8eMpLADFaWQc7iR5SShpZRDJSGC2sThvi";
        let allTickets = [];

        async function loadTickets() {
            try {
                const res = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, { headers: { "X-Master-Key": MASTER_KEY } });
                const data = await res.json();
                allTickets = data.record || [];
                displayTickets();
            } catch (e) { document.getElementById("ticketsList").innerHTML = "Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø³Ø­Ø§Ø¨Ø©"; }
        }

        function displayTickets() {
            const list = document.getElementById("ticketsList");
            list.innerHTML = allTickets.length === 0 ? "<h3>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø¯Ø¹Ù… Ø­Ø§Ù„ÙŠØ§Ù‹</h3>" : "";
            allTickets.forEach((t, i) => {
                let chat = t.messages.map(m => `<div class="msg ${m.role==='admin'?'admin-msg':'player-msg'}"><strong>${m.role==='admin'?'Ø£Ù†Øª':'Ø§Ù„Ù„Ø§Ø¹Ø¨'}:</strong> ${m.text}</div>`).join('');
                list.innerHTML += `<div class="ticket-item">
                    <h3>Ù„Ø§Ø¹Ø¨: ${t.playerName}</h3><div class="chat-box">${chat}</div>
                    <input type="text" id="rep-${i}" placeholder="Ø±Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ù„Ø§Ø¹Ø¨...">
                    <button class="reply-btn" onclick="sendReply(${i})">Ø¥Ø±Ø³Ø§Ù„</button>
                    <button class="del-btn" onclick="deleteTicket(${i})">Ø­Ø°Ù</button>
                </div>`;
            });
        }

        async function sendReply(i) {
            const text = document.getElementById(`rep-${i}`).value;
            if(!text) return;
            allTickets[i].messages.push({ role: 'admin', text: text });
            await updateCloud();
            loadTickets();
        }

        async function deleteTicket(i) {
            if(confirm("Ø­Ø°Ù Ø§Ù„ØªÙŠÙƒÙŠØªØŸ")) { allTickets.splice(i, 1); await updateCloud(); loadTickets(); }
        }

        async function updateCloud() {
            await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`, { method: 'PUT', headers: { "Content-Type": "application/json", "X-Master-Key": MASTER_KEY }, body: JSON.stringify(allTickets) });
        }
        window.onload = loadTickets;
    </script>
</body>
</html>
