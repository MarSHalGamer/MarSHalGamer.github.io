<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØªØ¬Ø± - RP City</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
<style>
    body { margin: 0; font-family: 'Cairo', sans-serif; background: radial-gradient(circle at top, #1a1b4b, #000000 80%); color: white; text-align: center; padding: 40px; }
    .container { width: 90%; max-width: 700px; margin: 0 auto; background: rgba(0,0,0,0.6); padding: 30px; border-radius: 20px; border: 1px solid #a855f7; box-shadow: 0 0 20px rgba(168,85,247,0.3); }
    input, textarea { width: 100%; background: #000; color: white; border: 1px solid #444; border-radius: 10px; padding: 12px; font-family: 'Cairo'; margin: 10px 0; box-sizing: border-box; }
    
    .image-upload-area { width: 100%; height: 150px; border: 2px dashed #a855f7; border-radius: 15px; margin: 10px 0; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; transition: 0.3s; background: rgba(0,0,0,0.3); overflow: hidden; position: relative; }
    .image-upload-area:hover { background: rgba(168,85,247,0.1); }
    .image-upload-area img { width: 100%; height: 100%; object-fit: contain; display: none; }
    
    .btn { background: linear-gradient(135deg, #7c3aed, #1e1b4b); color: white; border: 2px solid #a855f7; padding: 12px; border-radius: 10px; cursor: pointer; width: 100%; font-family: 'Cairo'; font-size: 18px; margin-top: 10px; transition: 0.3s; }
    .btn:hover { transform: scale(1.02); box-shadow: 0 0 15px #a855f7; }

    .item { background: rgba(255,255,255,0.05); padding: 15px; margin-top: 10px; border-radius: 10px; border-right: 4px solid #a855f7; display: flex; justify-content: space-between; align-items: center; }
    .edit-btn { background: #0ea5e9; border:none; color:white; padding: 5px 10px; border-radius: 5px; cursor:pointer; margin-left:5px; }
    .del-btn { background: #ef4444; border:none; color:white; padding: 5px 10px; border-radius: 5px; cursor:pointer; }
</style>
</head>
<body>

<h1>ğŸ› ï¸ Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØªØ¬Ø± (Ø³Ø­Ø§Ø¨ÙŠ)</h1>
<div class="container">
    <div class="image-upload-area" id="dropArea" onclick="document.getElementById('fileInput').click()">
        <p id="uploadText">ğŸ“ Ø§Ø¶ØºØ· Ø£Ùˆ Ø§Ø³Ø­Ø¨ ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬ Ù‡Ù†Ø§</p>
        <img id="previewImg" src="">
    </div>
    <input type="file" id="fileInput" accept="image/*" style="display: none;" onchange="previewFile()">
    
    <input type="text" id="pName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬ (Ù…Ø«Ø§Ù„: Ø¨Ø§Ù‚Ø© VIP)">
    <input type="text" id="pPrice" placeholder="Ø§Ù„Ø³Ø¹Ø± (Ù…Ø«Ø§Ù„: 50,000)">
    <textarea id="pDesc" rows="3" placeholder="ÙˆØµÙ Ø§Ù„Ù…Ù†ØªØ¬..."></textarea>
    
    <button class="btn" id="mainBtn" onclick="handleShop()">Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù…ØªØ¬Ø±</button>
    
    <div id="pList" style="margin-top:20px;">
        </div>
</div>

<script>
    // âš ï¸ Ø¶Ø¹ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù…Ù† JSONBin Ù‡Ù†Ø§
    const BIN_ID = "6994cdcaae596e708f328b2e"; 
    const MASTER_KEY = "$2a$10$EVJpa1kkUQx4JG6CPhwT8eMpLADFaWQc7iR5SShpZRDJSGC2sThvi"; 

    let shopArray = [];
    let editIdx = -1;
    let currentImageData = ""; 

    window.onload = draw;

    // ÙˆØ¸ÙŠÙØ© Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø³Ø­Ø§Ø¨Ø©
    async function loadData() {
        try {
            const res = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, {
                headers: { "X-Master-Key": MASTER_KEY }
            });
            const data = await res.json();
            shopArray = data.record || [];
        } catch (e) {
            console.error("Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:", e);
        }
    }

    // ÙˆØ¸ÙŠÙØ© Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„Ø³Ø­Ø§Ø¨Ø©
    async function saveData() {
        try {
            await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`, {
                method: 'PUT',
                headers: {
                    "Content-Type": "application/json",
                    "X-Master-Key": MASTER_KEY
                },
                body: JSON.stringify(shopArray)
            });
        } catch (e) {
            alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­ÙØ¸ ÙÙŠ Ø§Ù„Ø³Ø­Ø§Ø¨Ø©");
        }
    }

    // Ù…Ø¹Ø§ÙŠÙ†Ø© ÙˆØ¶ØºØ· Ø§Ù„ØµÙˆØ±Ø©
    function previewFile() {
        const file = document.getElementById('fileInput').files[0];
        const reader = new FileReader();
        reader.onload = (e) => {
            const img = new Image();
            img.src = e.target.result;
            img.onload = () => {
                const canvas = document.createElement('canvas');
                const maxWidth = 400; // ØªØµØºÙŠØ± Ø§Ù„ØµÙˆØ±Ø© Ù„Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ø³Ø­Ø§Ø¨Ø©
                const scale = maxWidth / img.width;
                canvas.width = maxWidth;
                canvas.height = img.height * scale;
                const ctx = canvas.getContext('2d');
                ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                currentImageData = canvas.toDataURL('image/jpeg', 0.6); // Ø¶ØºØ· Ø§Ù„Ø¬ÙˆØ¯Ø©
                document.getElementById('previewImg').src = currentImageData;
                document.getElementById('previewImg').style.display = 'block';
                document.getElementById('uploadText').style.display = 'none';
            };
        };
        if (file) reader.readAsDataURL(file);
    }

    async function handleShop() {
        const n = document.getElementById("pName"), p = document.getElementById("pPrice"), d = document.getElementById("pDesc");
        if(!n.value || !p.value) return alert("ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ø³Ø¹Ø±");

        const item = { 
            name: n.value, 
            price: p.value, 
            desc: d.value, 
            image: currentImageData 
        };

        document.getElementById("mainBtn").innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...";
        document.getElementById("mainBtn").disabled = true;

        if(editIdx === -1) {
            // Ù…Ø³Ø­ Ø§Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙˆØ¬ÙˆØ¯Ø©
            if(shopArray.length === 1 && shopArray[0].name === "Ø¨Ø§Ù‚Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ©") shopArray = [];
            shopArray.push(item);
        } else {
            shopArray[editIdx] = item;
            editIdx = -1;
        }

        await saveData();
        document.getElementById("mainBtn").innerText = "Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù…ØªØ¬Ø±";
        document.getElementById("mainBtn").disabled = false;
        
        resetForm();
        draw();
    }

    function resetForm() {
        document.getElementById("pName").value = "";
        document.getElementById("pPrice").value = "";
        document.getElementById("pDesc").value = "";
        document.getElementById("previewImg").style.display = "none";
        document.getElementById("uploadText").style.display = "block";
        currentImageData = "";
    }

    async function draw() {
        const list = document.getElementById("pList");
        list.innerHTML = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...";
        await loadData();
        list.innerHTML = "";
        shopArray.forEach((it, i) => {
            list.innerHTML += `<div class="item">
                <span><strong>${it.name}</strong> (${it.price})</span>
                <div>
                    <button class="edit-btn" onclick="startEdit(${i})">ØªØ¹Ø¯ÙŠÙ„</button>
                    <button class="del-btn" onclick="del(${i})">Ø­Ø°Ù</button>
                </div>
            </div>`;
        });
    }

    function startEdit(i) {
        editIdx = i;
        const item = shopArray[i];
        document.getElementById("pName").value = item.name;
        document.getElementById("pPrice").value = item.price;
        document.getElementById("pDesc").value = item.desc;
        currentImageData = item.image;
        if(currentImageData) {
            document.getElementById('previewImg').src = currentImageData;
            document.getElementById('previewImg').style.display = 'block';
            document.getElementById('uploadText').style.display = 'none';
        }
        document.getElementById("mainBtn").innerText = "ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†ØªØ¬";
    }

    async function del(i) {
        if(confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø­Ø°Ù Ù„Ù„Ø¬Ù…ÙŠØ¹ØŸ")) {
            shopArray.splice(i,1);
            await saveData();
            draw();
        }
    }
</script>

</body>
</html>
