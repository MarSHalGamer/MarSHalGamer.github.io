<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØªØ¬Ø± - RP City</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
<style>
    body { margin: 0; font-family: 'Cairo', sans-serif; background: radial-gradient(circle at top, #1a1b4b, #000000 80%); color: white; text-align: center; padding: 40px; }
    .container { width: 90%; max-width: 700px; margin: 0 auto; background: rgba(0,0,0,0.6); padding: 30px; border-radius: 20px; border: 1px solid #a855f7; }
    input, textarea { width: 100%; background: #000; color: white; border: 1px solid #444; border-radius: 10px; padding: 12px; font-family: 'Cairo'; margin: 10px 0; box-sizing: border-box; }
    
    /* Ø³ØªØ§ÙŠÙ„ Ù…Ù†Ø·Ù‚Ø© Ø±ÙØ¹ Ø§Ù„ØµÙˆØ± */
    .image-upload-area {
        width: 100%; height: 150px; border: 2px dashed #a855f7; border-radius: 15px;
        margin: 10px 0; display: flex; flex-direction: column; align-items: center;
        justify-content: center; cursor: pointer; transition: 0.3s; background: rgba(0,0,0,0.3);
        overflow: hidden; position: relative;
    }
    .image-upload-area:hover { background: rgba(168, 85, 247, 0.1); }
    .image-upload-area img { width: 100%; height: 100%; object-fit: contain; display: none; }
    .image-upload-area p { pointer-events: none; }

    .btn { background: linear-gradient(135deg, #7c3aed, #1e1b4b); color: white; border: 2px solid #a855f7; padding: 12px; border-radius: 10px; cursor: pointer; width: 100%; font-family: 'Cairo'; font-size: 18px; margin-top: 10px; }
    .item { background: rgba(255,255,255,0.05); padding: 15px; margin-top: 10px; border-radius: 10px; border-right: 4px solid #a855f7; display: flex; justify-content: space-between; align-items: center; text-align: right; }
    .edit-btn { background: #0ea5e9; border:none; color:white; padding: 5px 10px; border-radius: 5px; cursor:pointer; margin-left:5px; font-family: 'Cairo'; }
    .del-btn { background: #ef4444; border:none; color:white; padding: 5px 10px; border-radius: 5px; cursor:pointer; font-family: 'Cairo'; }
    .item-info { display: flex; align-items: center; gap: 15px; }
    .item-preview { width: 50px; height: 50px; border-radius: 8px; object-fit: cover; border: 1px solid #a855f7; }
</style>
</head>
<body>
    <h1>ğŸ›’ Ø¥Ø¯Ø§Ø±Ø© Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…ØªØ¬Ø±</h1>
    <div class="container">
        <div class="image-upload-area" id="dropArea" onclick="document.getElementById('fileInput').click()">
            <p id="uploadText">ğŸ“ Ø§Ø³Ø­Ø¨ Ø§Ù„ØµÙˆØ±Ø© Ù‡Ù†Ø§ Ø£Ùˆ Ø§Ø¶ØºØ· Ù„Ù„Ø§Ø®ØªÙŠØ§Ø±</p>
            <img id="previewImg" src="" alt="Preview">
        </div>
        <input type="file" id="fileInput" accept="image/*" style="display: none;" onchange="previewFile()">
        
        <input type="text" id="pName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¨Ø§Ù‚Ø©/Ø§Ù„Ù…Ù†ØªØ¬">
        <input type="text" id="pPrice" placeholder="Ø§Ù„Ø³Ø¹Ø± (Ù…Ø«Ù„Ø§Ù‹: 50k ÙƒØ±ÙŠØ¯Øª)">
        <textarea id="pDesc" placeholder="ÙˆØµÙ Ø§Ù„Ù…Ù†ØªØ¬ (Ù…Ù…ÙŠØ²Ø§ØªÙ‡)"></textarea>
        <button class="btn" id="mainBtn" onclick="handleShop()">Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù…ØªØ¬Ø±</button>
        <div id="pList" style="margin-top:20px;"></div>
    </div>
    <a href="admin_panel.html" style="display:block; margin-top:30px; color:#888; text-decoration:none;">â¬… Ø¹ÙˆØ¯Ø©</a>

    <script>
        let shopArray = JSON.parse(localStorage.getItem("serverShopArray") || "[]");
        let editIdx = -1;
        let currentImageData = ""; // Ù„ØªØ®Ø²ÙŠÙ† ÙƒÙˆØ¯ Ø§Ù„ØµÙˆØ±Ø©

        window.onload = draw;

        // ÙˆØ¸ÙŠÙØ© Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙˆØ±Ø© Ø¹Ù†Ø¯ Ø§Ø®ØªÙŠØ§Ø±Ù‡Ø§
        function previewFile() {
            const file = document.getElementById('fileInput').files[0];
            const reader = new FileReader();
            reader.onloadend = function() {
                document.getElementById('previewImg').src = reader.result;
                document.getElementById('previewImg').style.display = 'block';
                document.getElementById('uploadText').style.display = 'none';
                currentImageData = reader.result; // Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±Ø© ÙÙŠ Ù…ØªØºÙŠØ±
            }
            if (file) reader.readAsDataURL(file);
        }

        // ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø³Ø­Ø¨ ÙˆØ§Ù„Ø¥ÙÙ„Ø§Øª
        const dropArea = document.getElementById('dropArea');
        dropArea.ondragover = (e) => { e.preventDefault(); dropArea.style.borderColor = "#fff"; };
        dropArea.ondragleave = () => { dropArea.style.borderColor = "#a855f7"; };
        dropArea.ondrop = (e) => {
            e.preventDefault();
            const file = e.dataTransfer.files[0];
            document.getElementById('fileInput').files = e.dataTransfer.files;
            previewFile();
        };

        function handleShop() {
            const n = document.getElementById("pName"), p = document.getElementById("pPrice"), d = document.getElementById("pDesc");
            if(!n.value || !p.value) return alert("ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ø³Ø¹Ø±");

            const item = { 
                name: n.value, 
                price: p.value, 
                desc: d.value, 
                image: currentImageData // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØµÙˆØ±Ø© Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            };

            if(editIdx === -1) {
                shopArray.push(item);
            } else {
                shopArray[editIdx] = item;
                editIdx = -1;
                document.getElementById("mainBtn").innerText = "Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù…ØªØ¬Ø±";
            }

            localStorage.setItem("serverShopArray", JSON.stringify(shopArray));
            resetForm();
            draw();
        }

        function resetForm() {
            document.getElementById("pName").value = "";
            document.getElementById("pPrice").value = "";
            document.getElementById("pDesc").value = "";
            document.getElementById("previewImg").src = "";
            document.getElementById("previewImg").style.display = "none";
            document.getElementById("uploadText").style.display = "block";
            currentImageData = "";
        }

        function draw() {
            const list = document.getElementById("pList");
            list.innerHTML = "";
            shopArray.forEach((it, i) => {
                list.innerHTML += `<div class="item">
                    <div class="item-info">
                        <img src="${it.image || 'https://via.placeholder.com/50'}" class="item-preview">
                        <span><strong>${it.name}</strong> (${it.price})</span>
                    </div>
                    <div>
                        <button class="edit-btn" onclick="startEdit(${i})">ØªØ¹Ø¯ÙŠÙ„</button>
                        <button class="del-btn" onclick="del(${i})">Ø­Ø°Ù</button>
                    </div>
                </div>`;
            });
        }

        function startEdit(i) {
            editIdx = i;
            const item = shopArray[i];
            document.getElementById("pName").value = item.name;
            document.getElementById("pPrice").value = item.price;
            document.getElementById("pDesc").value = item.desc;
            if(item.image) {
                document.getElementById("previewImg").src = item.image;
                document.getElementById("previewImg").style.display = "block";
                document.getElementById("uploadText").style.display = "none";
                currentImageData = item.image;
            }
            document.getElementById("mainBtn").innerText = "ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¢Ù†";
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function del(i) {
            if(confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ØŸ")) {
                shopArray.splice(i,1);
                localStorage.setItem("serverShopArray", JSON.stringify(shopArray));
                draw();
            }
        }
    </script>
</body>
</html>
